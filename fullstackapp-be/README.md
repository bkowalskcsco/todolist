## Prerequisites

1. Java SDK 19 - https://www.freecodecamp.org/news/install-openjdk-free-java-multi-os-guide/
2. IDE - suggested IntelliJ https://www.jetbrains.com/idea/download/

## How to create Spring Boot app template?

1. Visit https://start.spring.io/
2. Fill required fields:
    1. Project: `Maven`
    2. Language: `Java`
    3. Spring Boot: `3.0.0`
    4. Metadata:
        - group: `com.example`
        - artifact: `todolist-be`
        - name: `todolist-be`
        - description: anything you'd like
        - package name: `com.example.fullstackapp`
        - packaging: `jar`
        - java: `19`
    5. Dependencies:
        - `lombok`
        - `Spring Data JPA`
        - `H2 Database`
        - `Spring Web`
        - `Validation`
        - `Actuator`
3. Hit `GENERATE`
4. Copy contents of the zip file into your workspace and import generated project using your IDE.
5. Run `mvn clean install` to check if setup is correct.

## Let's create an app

1. Create packages: `application`, `infrastructure` & `domain`.
2. Setup `application.yml` (instead of properties):
   ````yml
   spring:
     jackson:
       date-format: com.fasterxml.jackson.databind.util.StdDateFormat
       time-zone: UTC
     datasource:
       url: jdbc:h2:mem:mydb
       username: sa
       password: password
       driverClassName: org.h2.Driver
     jpa:
       spring.jpa.database-platform: org.hibernate.dialect.H2Dialect
   server:
     servlet:
       context-path: /todolist
   ````
3. Setup tests - create `base` package and create there 3 base abstract classes:

    - `AbstractE2ETest`
    ````java
    package com.example.fullstackapp.base;
    
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
    import org.springframework.test.web.servlet.MockMvc;
    
    import com.fasterxml.jackson.databind.ObjectMapper;
    
    @AutoConfigureMockMvc
    public abstract class AbstractE2ETest extends AbstractIntegrationTest {
    
        @Autowired
        protected MockMvc mockMvc;
        @Autowired
        protected ObjectMapper objectMapper;
    
    }
    ````

    - `AbstractIntegrationTest`
    ````java
    package com.example.fullstackapp.base;
    
    import org.junit.jupiter.api.DisplayNameGeneration;
    import org.junit.jupiter.api.DisplayNameGenerator;
    import org.junit.jupiter.api.extension.ExtendWith;
    import org.springframework.boot.test.context.SpringBootTest;
    import org.springframework.test.context.junit.jupiter.SpringExtension;
    
    @ExtendWith(SpringExtension.class)
    @DisplayNameGeneration(DisplayNameGenerator.ReplaceUnderscores.class)
    @SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
    public abstract class AbstractIntegrationTest {
    
    }
    ````

    - `AbstractUnitTest`
    ````java
    package com.example.fullstackapp.base;
    
    import org.junit.jupiter.api.DisplayNameGeneration;
    import org.junit.jupiter.api.DisplayNameGenerator;
    import org.junit.jupiter.api.extension.ExtendWith;
    import org.mockito.junit.jupiter.MockitoExtension;
    
    @ExtendWith(MockitoExtension.class)
    @DisplayNameGeneration(DisplayNameGenerator.ReplaceUnderscores.class)
    public abstract class AbstractUnitTest {
    
    
    }
    ````

## DOMAIN LAYER

1. Create domain context - package named `todo`.
2. Create domain classes - `Item`, `ItemNotFoundException` & `ItemRepository`.
3. Create domain service for time evaluation - `TimeService` outside of `todo` package.

Requirements:

* Class Item should utilize `lombok`, `JPA` & `Bean Validation` annotations.
* Item should be JPA entity.
* `Item` should contain fields:
    - `Long id` - meant for db identifier, should be autogenerated
    - `String title` - for todolist title, string of size between 1 - 128 signs
    - `String content` - for todolist content, string of size between 1 - 1000 signs
    - `boolean completed` - completion flag
    - `ZonedDateTime creationDate` - entity creation timestamp, UTC, cannot be `null`
    - `ZonedDateTime updateDate` - entity update timestamp, UTC, starts as `null`
* ItemRepository should be simple interface exposing domain repository operations.
* Exception should be runtime type.
* `TimeService` should expose current `ZonedDateTime` generation in `UTC`.

## APPLICATION LAYER

1. Create two classes: `ItemDetails` and `ItemService`

Requirements:

* `ItemDetails` should be simple DTO meant to be used to create new TODO items (and update them). It could be Java
  record containing fields `title`, `content` and `completed`.
* `ItemService` should be application service (Spring component of type service); service should expose four
  methods: `getItems`, `getItemById`, `createItem`, `deleteItem` & `updateItem`.
* `ItemService` should utilize logger - use `lombok` `@Slf4j` annotation to inject logger instance.

## INFRASTRUCTURE LAYER

1. Create `repository` and `rest` packages.
2. `repository` should contain two elements: `ItemJpaRepository` interface & `ItemRepositoryImpl` class.
3. `rest` should contain `ItemController` Spring `RestController`.

Requirements:

* `ItemJpaRespository` should be Spring Data JPA repository for `Item` entity.
  See: https://www.baeldung.com/the-persistence-layer-with-spring-data-jpa for details.
* `ItemRepositoryImpl` should be implementation (adapter) of `ItemRepository` domain interface (port) and delegate
  corresponding domain operation to Spring Data component.
* `ItemController` should be Spring REST controller exposing operations like: `GET`, `POST`, `PUT` & `DELETE` over item
  resources. See https://www.baeldung.com/building-a-restful-web-service-with-spring-and-java-based-configuration
  for examples.

## How to validate whether app is working?

You could use any REST client app like `Postman` or `IntelliJ REST client`. Here's snippet:

````http request
POST http://localhost:8080/todolist/items
Content-Type: application/json

{
  "title": "This is a new item!",
  "content": "Item content! This might be a longer string test test test!!!"
}

###

GET http://localhost:8080/todolist/items
Accept: application/json

###

PUT http://localhost:8080/todolist/items/2
Content-Type: application/json

{
  "title": "This is a new item!",
  "content": "Item content! This might be a longer string test test test!!!",
  "completed": true
}

###

DELETE http://localhost:8080/todolist/items/1
````

## TEST LAYER

1. All classes containing logic should be covered with unit tests. You should use `AbstractUnitTest` to be a root for
   all unit tests.
2. REST controller should use E2E test suite using `MockMVC`. Use `AbstractE2ETest` as a base class for all tests in
   this category. MockMVC example: https://www.baeldung.com/integration-testing-in-spring

## Dockerize

1. Add this line to `pom.xml` to ensure artifact name will be constant among version changes:
    ````xml
    <finalName>todolist-be</finalName>
    ````
2. Create `Dockerfile` in the application root and paste this code:
    ````dockerfile
    FROM eclipse-temurin:19

    RUN mkdir -p /app
    WORKDIR /app

    COPY target/todolist-be.jar /

    ENTRYPOINT ["java", "-jar", "/todolist-be.jar"]
    ````
